import{n as O,o as E,r as f,b as c,h as F,g as D,p as S,q as A,j as e,F as k,B as g,f as R,s as $,t as q,i as G,v as V}from"./index-83559760.js";import{E as B}from"./EmptyCart-9b55cf1d.js";import{u as J}from"./useDispatch-9efe5d97.js";const L=r=>/^\+?\d{1,4}?[-.\s]?\(?\d{1,3}?\)?[-.\s]?\d{1,4}[-.\s]?\d{1,4}[-.\s]?\d{1,9}$/.test(r),T="Please give us your correct phone number, we might need it to contact you.";function W(){const r=O(),s=E(),[t,a]=f.useState(!1),{status:i,position:{latitude:l,longitude:n},address:j,error:y}=c(o=>o.user),d=i==="loading",m=!l&&!n,N=!m,p=c(F),b=c(D),u=c(S),x=J(),v=t?u*.2:0,h=r.state==="submitting",w=u+v,C=!p.length,P=f.useCallback(o=>{o.preventDefault(),x(A())},[x]);return C?e.jsx(B,{}):e.jsxs("div",{className:"px-4 py-6",children:[e.jsx("h2",{className:"mb-8 text-xl font-semibold",children:"Ready to order? Let's go!"}),e.jsxs(k,{method:"POST",children:[e.jsx("div",{className:"mb-5 gap-2",children:e.jsxs("label",{className:"flex flex-col sm:flex-row sm:items-center",htmlFor:"customer",children:[e.jsx("span",{className:"sm:basis-40",children:"First Name"}),e.jsx("input",{className:"input grow",type:"text",name:"customer",defaultValue:b,required:!0})]})}),e.jsx("div",{className:"mb-5 gap-2",children:e.jsxs("label",{className:"flex flex-col sm:flex-row sm:items-center",htmlFor:"phone",children:[e.jsx("span",{className:"sm:basis-40",children:"Phone number"}),e.jsxs("div",{className:"grow",children:[e.jsx("input",{className:"input w-full",type:"tel",name:"phone",required:!0}),(s==null?void 0:s.phone)&&e.jsx("p",{className:"mt-2 rounded-md bg-red-300 p-4 text-xs text-red-100",children:s.phone})]})]})}),e.jsx("div",{className:"mb-5 gap-2",children:e.jsxs("label",{className:"relative flex flex-col sm:flex-row sm:items-center",htmlFor:"address",children:[e.jsx("span",{className:"sm:basis-40",children:"Address"}),e.jsxs("div",{className:"grow",children:[e.jsx("input",{disabled:d,defaultValue:j,className:"input w-full",type:"text",name:"address",required:!0}),i==="error"&&e.jsx("p",{className:"mt-2 rounded-md bg-red-100 p-2 text-xs text-red-700",children:y})]}),m&&e.jsx("span",{className:"absolute right-[5px] top-[3px] z-50 md:top-[5px]",children:e.jsx(g,{disabled:d,type:"small",onClick:P,children:"Get position"})})]})}),e.jsx("div",{className:"mb-12 flex items-center gap-5",children:e.jsxs("label",{className:"font-medium",htmlFor:"priority",children:[e.jsx("input",{className:"h-6 w-6 accent-yellow-400 focus:outline-none focus:ring focus:ring-yellow-400 focus:ring-offset-2",type:"checkbox",name:"priority",id:"priority",value:t,onChange:o=>a(o.target.checked)}),"Want to yo give your order priority?"]})}),e.jsxs("div",{children:[e.jsx("input",{type:"hidden",name:"cart",value:JSON.stringify(p)}),e.jsx("input",{type:"hidden",name:"position",value:N?`${l},${n}`:""}),e.jsx(g,{type:"primary",disabled:h||d,children:h?"Placing order...":`Order now from ${R(w)}`})]})]})]})}async function _({request:r}){const s=await r.formData(),t=Object.fromEntries(s),a={},i={...t,cart:JSON.parse(t.cart),priority:t.priority==="true"};if(L(i.phone)||(a.phone=T),Object.keys(a).length>0)return a;const n=await $(i);return q.dispatch(G()),V(`/order/${n.id}/`)}W.displayName="CreateOrder";export{W as Component,_ as action};
